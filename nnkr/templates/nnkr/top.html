{% extends 'nnkr/base.html' %}
{% load static %}
{% block content %}

<div class="pt-3">
  <h3 class="text-center">『雀魂何切る』へようこそ！</h3><hr>
</div>

<div class="alert alert-warning alert-dismissible shadow-sm" role="alert">
  <h4><i class="bi bi-info-circle"></i> 説明</h4>
  <ul>
    <li>当サイトは、雀魂段位戦を想定した立体何切るサイトです。プレイ中の画像をアップロードし、意見交換することができます。</li>
    <li>基本は段位戦を想定していますが、場合によってはその限りではありません。問題に回答する前に出題者の説明をきちんと読みましょう。</li>
    <li>投票・コメントは誰でも行えます(<a href="{% url 'nnkr:index' %}" class="link-dark-u">問題一覧へ</a>)。問題投稿する際は右上のナビバーから<a href="{% url 'user:login' %}" class="link-dark-u">ログイン</a>をお願いします。メールアドレスは不要です。</li>
    <li>その他よくあるご質問には<a href="{% url 'nnkr:faq' %}" class="link-dark-u">こちら</a>で回答しています。</li>
  </ul>
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>



<div>
  <div class="container">
    <div class="row">


      <!-- Lobby Chat -->
      <div class="col-lg-7 my-2">
        <div class="p-3 shadow" style="background:#f5f5f5">
          <h5>ロビーチャット</h5>

          <!-- Form -->
          <div class="comment-form mt-1">
            <form  action="{% url 'nnkr:create_lobbychat' %}" method="post" class="submit-only-one">{% csrf_token %}
            <div class="container">
              <div class="row">
                <div class="col-md-10 form-group">
                  <textarea
                    placeholder="自由に雑談しよう！"
                    type="{{chat_form.text.field.widget.input_type}}"
                    class="form-control"
                    {% if chat_form.text.field.required %}required{% endif %}
                    name="{{chat_form.text.name}}"
                    id="{{chat_form.text.id_for_label}}"
                    rows="1"></textarea>
                </div>
                <div class="col-md-2">
                  <button type="submit" class="btn btn-primary" style="width:100%;height:auto">送信</button>
                </div>
              </div>
            </div>
            </form>
          </div>
          
          <!-- Comments -->
          <div class="comment-box">
            <hr style="margin:8px">
            {% for chat in chats reversed %}
            <div class="chat-content">
              <div class="d-flex flex-row  mb-3">

                <div class="p-2">
                  <div  style="display:inline-block; vertical-align:top;">
                    <div class="icon-frame shadow-sm">
                      <div class="icon">
                        {% if chat.user %}
                          <img src="{{ chat.user.icon.url }}">
                        {% else %}
                          <img src="{% static 'img/icon/icon_guest.png' %}">
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>

                <div class="p-2">
                  <div>

                    {% if chat.user %}
                      <a class="link-dark-u" href="{% url 'user:detail' chat.user.id %}">[{{chat.user}}]</a>
                    {% else %}
                      [名無しさん]
                    {% endif %}
                    <small>
                    {{chat.posted_at|date:"y年m月j日 H:i"}}
                    </small>
                    <br>

                    <div style="font-size:18px;">
                      {{chat.text | linebreaksbr}}
                      {% if chat.is_updated %}
                        <small style="color:#808080">[{{chat.updated_at|date:"y年m月j日 H:i"}} 編集済] </small>
                      {% endif %}
                    </div>

                  </div>
                </div>

              </div>
            </div>
            <hr style="margin-top:-20px;margin-bottom:0px;">
            {% endfor %}
          </div>

          <!-- Paging -->
          <div class="p-2">
            {% include "nnkr/pagination.html" with page_obj=chats %}
          </div>

        </div>
      </div>


      <div class="col-lg-5 my-2">

        <!-- Hot Question -->
        <div class="my-4"> 
            <h5 style="display:inline-block">注目されている問題</h5>
            <small>(画像クリックで拡大)</small>
            <hr style="margin-top:0px">
            {% include "nnkr/question_cards_min.html" with questions=questions %}
        </div>

        <!-- Tweet -->
        <div class="my-4">
            <a class="twitter-timeline" data-lang="en" data-height="500"
              data-theme="light"
              href="https://twitter.com/3Dnnkr?ref_src=twsrc%5Etfw">Tweets by 3Dnnkr</a>
        </div>

      </div>

    </div>
  </div>
</div>
{% endblock %}